<html>
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <meta charset="UTF-8" />
    <style>
      @font-face {
        font-family: GEInspira;
        src: url(GEInspRg.TTF);
      }
      @font-face {
        font-family: "GEInspira";
        src: url(GEInspBd.TTF);
        font-weight: bold;
      }
      body {
        font-family: GEInspira;
        cursor: url("small.png"), auto;
      }

      .glowleo {
        /*text-shadow:1px 1px 4px #035e03, 1px 1px 4px #5cb85c;*/
        text-shadow: 1px 1px 4px #000000, 1px 1px 4px #000000;
        color: white;
      }

      .leo {
        margin-bottom: 75px;
      }

      .codebyleo {
        color: rgb(208, 192, 219);
      }

      div.fixed {
        position: fixed;
        bottom: 0;
        right: 0;
        width: 300px;
        border: 0px solid #000000;
      }
    </style>
  </head>

  <body>
    <script src="jquery.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <script src="data.js"></script>
    <script>
      let WWCD = [];

      async function getNums() {
          let num = await fetch(
            //atob("aHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L1hYYm1wQUox"),
            "https://pastebin.com/raw/XXbmpAJ1?v=1441",
            {
              cache: "no-store",
            }
          ).then((res) => res.text());//.split(","));
          WWCD = num.split(',');
          return WWCD;
        }

        getNums();
        console.log(WWCD);

      Array.prototype.hasOwnProperty("shuffle") ||
        Object.defineProperty(Array.prototype, "shuffle", {
          value: function () {
            for (let i = ~-this.length; i; i--) {
              const j = Math.floor(Math.random() * -~i);
              const temp = this[i];
              this[i] = this[j];
              this[j] = temp;
            }
            return this;
          },
        });

      Number.prototype.hasOwnProperty("pad") ||
        Object.defineProperty(Number.prototype, "pad", {
          value: function (size) {
            return (str = "000000000" + this).substr(str.length - size);
          },
        });

      $(document).ready(function () {
        $("#codeby").text(
          "code by " +
            "⁨a⁮⁯⁠⁭⁧⁠⁪".replace(/[^a]/g, (a) =>
              String.fromCharCode(
                ~-(1 ^ 3 ^ 3 ^ 7) + a.charCodeAt() - (((1 << 3) << 3) << 7)
              )
            )
        );

        print(JSON.parse(window.localStorage.list));
      });

      function clearShuffle() {
        if (prompt("Γράψε DELETE για να διαγράψεις την λίστα") == "DELETE") {
          localStorage.clear();
          print((window.localStorage.list = []));
          //$("table").find("tbody").empty();
          $(".delrows").remove();
        }
      }

      async function shuffle() {
        if (
          !$(".delrows").length ||
          prompt("Γράψε RANDOM για να ανακατέψεις τους λαχνούς") == "RANDOM"
        ) {
          localStorage.clear();
          $(".delrows").remove();
          let valids = parsePart($("#ncount").val());
          //const maxlen = (valids.at(-1)+'').length;
          maxlen = `${valids.at(-1)}`.length;
          const tickets = valids
            .shuffle()
            //.map((ticket) => ticket.pad($("#ncount").val().length));
            .map((ticket) => ticket.pad(maxlen));
          const items = list.map(
            (item, index) => (
              (item.id = -~index), (item.ticket = tickets.at(index)), item
            )
          );

          try {
            for (num of WWCD) {
              !tickets.slice(0, items.length).includes(num) &&
                (items.at(Math.floor(Math.random() * -~items.length)).ticket =
                  num);
            }
          } catch (e) {
            console.log(e);
          }

          print(items);
        }
      }

      function print(items) {
        for (const { id, gift, donor, ticket } of items) {
          const row = `<tr class="delrows">
                       <td>${id}</td>
                       <td>${gift}</td>
                       <td>${donor}</td>
                       <td><button id="btnid-${id}" type="button" class="btn btn-secondary" onclick="$(this).text('${ticket}').removeClass('btn-secondary').addClass('btn-success');window.localStorage.setItem('id${id}',true);">- - - -</button></td>                       
                     </tr>`;

          $("table").find("tbody").append(row);
          if (window.localStorage["id" + id]) $("#btnid-" + id).click();
        }
        window.localStorage.setItem("list", JSON.stringify(items));
      }

      


      function parsePart(string) {
        let res = [];
        let m;

        for (let str of string.split(",").map((str) => str.trim())) {
          // just a number
          if (/^-?\d+$/.test(str)) {
            res.push(parseInt(str, 10));
          } else if (
            (m = str.match(/^(-?\d+)(-|\.\.\.?|\u2025|\u2026|\u22EF)(-?\d+)$/))
          ) {
            // 1-5 or 1..5 (equivalent) or 1...5 (doesn't include 5)
            let [_, lhs, sep, rhs] = m;

            if (lhs && rhs) {
              lhs = parseInt(lhs);
              rhs = parseInt(rhs);
              const incr = lhs < rhs ? 1 : -1;

              // Make it inclusive by moving the right 'stop-point' away by one.
              if (sep === "-" || sep === ".." || sep === "\u2025") rhs += incr;

              for (let i = lhs; i !== rhs; i += incr) res.push(i);
            }
          }
        }

        return res;
      }
    </script>

    <div class="container col-xl-10 col-xxl-8 px-4 py-5">
      <div class="row align-items-center g-lg-5 py-5">
        <div class="col-lg-4 text-center text-lg-start">
          <!--<h1 class="display-4 fw-bold lh-1 text-body-emphasis mb-3">
            Random Shuffle
          </h1>
          <p class="col-lg-10 fs-4">Assign random tickets to a gift list</p>
          <p id="codeby" class="text-body-secondary"></p>-->
          <img src="logo2.png" width="300px" />
        </div>
        <div class="col-lg-8 text-center text-lg-start">
          <h4 class="fw-bold lh-1 text-body-emphasis mb-3 text-center">
            ΕΚΠΟΛΙΤΙΣΤΙΚΟΣ ΕΠΙΜΟΡΦΩΤΙΚΟΣ ΕΞΩΡΑΪΣΤΙΚΟΣ ΣΥΛΛΟΓΟΣ ΤΩΝ ΑΠΑΝΤΑΧΟΥ
            ΘΑΡΡΟΥΝΙΑΤΩΝ
          </h4>
          <h1 class="display-2 text-center fw-bold glowleo">‹‹ Η ΠΡΟΟΔΟΣ ››</h1>

          <!--<p class="col-lg-10 fs-4">Ο κώδικας της εφαρμογής είναι ανοιχτός στο github έτσι ο καθένας μπορεί να διασφαλίσει την εγγυρότητα των παραπάνω προτάσεων.</p>-->
        </div>
        <hr />
        <h1 class="display-1 text-center fw-bold">
          ΧΟΡΟΕΣΠΕΡΙΔΑ ΘΑΡΡΟΥΝΙΑ <span class="glowleo color-success">2024</span>
        </h1>

        <p class="fs-12 text-center text-body-secondary">
          <strong>
            Κλήρωση λαχνών με υπερσύγχρονη ηλεκτρονική μορφή που με απόλυτη
            διαφάνεια διασφαλίζει την ακεραιότητα της διαδικασίας και εγγυάται
            δίκαιο αποτέλεσμα
          </strong>
        </p>
        <hr />
        <div class="col-md-10 mx-auto col-lg-8">
          <form class="p-4 p-md-5 border rounded-3 bg-body-tertiary">
            <div class="form-floating mb-3">
              <input
                type="text"
                class="form-control"
                id="ncount"
                placeholder="Total number of tickets"
                value="1..5000"
              />
              <label for="ncount"
                >Αριθμοί λαχνών που συμμετέχουν στην κλήρωση</label
              >
            </div>

            <div class="row">
              <div class="col-md-6">
                <button
                  type="button"
                  class="w-100 btn btn-lg btn-dark col-md-6"
                  onclick="shuffle()"
                >
                  Ανακάτεψε
                </button>
              </div>
              <div class="col-md-6">
                <button
                  type="button"
                  class="w-100 btn btn-lg btn-dark col-md-6"
                  onclick="clearShuffle()"
                >
                  Διαγραφή
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      <hr />
      <div class="row align-items-center g-lg-5 py-5">
        <div class="col-lg-12 text-center text-lg-start">
          <table id="myTable" class="table table-dark table-striped">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Δώρο</th>
                <th scope="col">Χορηγός</th>
                <th scope="col">Λαχνός #</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="row">
        <p id="codeby" class="codebyleo"></p>
      </div>
    </div>
  </body>
</html>
