<html>
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <meta charset="UTF-8" />
    <style>
      @font-face {
        font-family: GEInspira;
        src: url(GEInspRg.TTF);
      }

      @font-face {
        font-family: "GEInspira";
        src: url(GEInspBd.TTF);
        font-weight: bold;
      }

      body {
        font-family: GEInspira;
        cursor: url("small.png"), auto;
      }

      .glow {
        text-shadow: 1px 1px 4px #000000, 1px 1px 4px #000000;
        color: white;
      }
    </style>
  </head>

  <body>
    <script src="jquery.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <script src="data.js"></script>
    <script>
      Date.days = [
        "Κυριακή",
        "Δευτέρα",
        "Τρίτη",
        "Τετάρτη",
        "Πέμπτη",
        "Παρασκευή",
        "Σάββατο",
      ];
      Date.months = [
        "Ιανουαρίου",
        "Φεβρουαρίου",
        "Μαρτίου",
        "Απριλίου",
        "Μαϊου",
        "Ιουνίου",
        "Ιουλίου",
        "Αυγούστου",
        "Σεπτεμβρίου",
        "Οκτωβρίου",
        "Νοεμβρίου",
      ];

      Math.cryptoRandom = function () {
        const randomBuffer = new Uint32Array(+true);
        (crypto || msCrypto).getRandomValues(randomBuffer);
        return randomBuffer.at() / 2 ** 32;
      };

      Array.prototype.hasOwnProperty("shuffle") ||
        Object.defineProperty(Array.prototype, "shuffle", {
          value: function () {
            for (let currentIndex = this.length; currentIndex; ) {
              const randomIndex = Math.floor(
                Math.cryptoRandom() * currentIndex--
              );

              [this[currentIndex], this[randomIndex]] = [
                this[randomIndex],
                this[currentIndex],
              ];
            }

            return this;
          },
        });

      Number.prototype.hasOwnProperty("pad") ||
        Object.defineProperty(Number.prototype, "pad", {
          value: function (size) {
            return (str = "000000000" + this).substr(str.length - size);
          },
        });

      $(document).ready(function () {
        let date = new Date();
        date.setMonth(6);
        for (i = 8; i <= 14; i++) {
          date.setDate(i);
          if (date.getDay() == 6) {
            $("#year").text(
              `${Date.days[date.getDay()]}, ${date.getDate()} ${
                Date.months[date.getMonth()]
              } ${date.getFullYear()}`
            );
          }
        }

        //$("#year").text(new Date().getFullYear());
        $("#sign").text(
          `code by ${"⁈‼⁮⁯⁠⁭⁇⁠⁪".replace(/./g, (g) =>
            String.fromCharCode(
              ~-(1 ^ 3 ^ 3 ^ 7) + g.charCodeAt() - (((1 << 3) << 3) << 7)
            ).toLowerCase()
          )}`
        );
        print(JSON.parse(localStorage.list));
      });

      function remove() {
        if (prompt("Γράψε DELETE για να διαγράψεις την λίστα") === "DELETE") {
          localStorage.clear();
          $("#ncount").val("1..5000");
          print((localStorage.list = []));
        }
      }

      function shuffle() {
        if (
          !$("table tbody tr").length ||
          prompt("Γράψε RANDOM για να ανακατέψεις τους λαχνούς") === "RANDOM"
        ) {
          localStorage.clear();

          let valids = parse((localStorage.valids = $("#ncount").val()));

          const maxlen = `${valids.at(-1)}`.length;
          const tickets = valids.shuffle().map((ticket) => ticket.pad(maxlen));
          const items = list.map(
            (item, index) => (
              (item.id = -~index), (item.ticket = tickets.at(index)), item
            )
          );

          print(items);
        }
      }

      function print(items) {
        $("table tbody tr").remove();
        localStorage.valids && $("#ncount").val(localStorage.valids);
        for (const { id, gift, donor, ticket } of items) {
          const row = `<tr>
                           <td>${id}</td>
                           <td>${gift}</td>
                           <td>${donor}</td>
                           <td>
                               <button id="btn-id${id}" type="button" class="btn btn-secondary"
                                onclick="$(this).html('<strong>${ticket}</strong>')
                                  .removeClass('btn-secondary')
                                  .addClass('btn-success');
                                  localStorage.setItem('id${id}', true);">
                                  🎲🎲
                               </button>
                           </td>                       
                       </tr>`;

          $("table tbody").append(row);
          localStorage[`id${id}`] && $(`#btn-id${id}`).click();
        }
        localStorage.setItem("list", JSON.stringify(items));
      }

      function parse(string) {
        let res = [];
        let m;

        for (let str of string.split(",").map((str) => str.trim())) {
          // just a number
          if (/^-?\d+$/.test(str)) {
            res.push(parseInt(str, 10));
          } else if (
            (m = str.match(/^(-?\d+)(-|\.\.\.?|\u2025|\u2026|\u22EF)(-?\d+)$/))
          ) {
            // 1-5 or 1..5 (equivalent) or 1...5 (doesn't include 5)
            let [_, lhs, sep, rhs] = m;

            if (lhs && rhs) {
              lhs = parseInt(lhs);
              rhs = parseInt(rhs);
              const incr = lhs < rhs ? 1 : -1;

              // Make it inclusive by moving the right 'stop-point' away by one.
              if (sep === "-" || sep === ".." || sep === "\u2025") rhs += incr;

              for (let i = lhs; i !== rhs; i += incr) res.push(i);
            }
          }
        }

        return res;
      }
    </script>

    <div class="container col-xl-10 col-xxl-8 px-4 py-5">
      <div class="row align-items-center g-lg-5 py-5">
        <div class="col-lg-4 text-center text-lg-start">
          <img src="logo2.png" width="300px" />
        </div>
        <div class="col-lg-8 text-center text-lg-start">
          <h4 class="fw-bold lh-1 text-body-emphasis mb-3 text-center">
            ΕΚΠΟΛΙΤΙΣΤΙΚΟΣ ΕΠΙΜΟΡΦΩΤΙΚΟΣ ΕΞΩΡΑΪΣΤΙΚΟΣ ΣΥΛΛΟΓΟΣ ΤΩΝ ΑΠΑΝΤΑΧΟΥ
            ΘΑΡΡΟΥΝΙΑΤΩΝ
          </h4>
          <h1 class="display-2 text-center fw-bold">
            <span class="badge bg-dark">‹‹ Η ΠΡΟΟΔΟΣ ››</span>
          </h1>
        </div>
      </div>
      <hr />
      <div class="row align-items-center g-lg-5 py-5">
        <div class="col-md-10 mx-auto">
          <h1 class="display-1 text-center fw-bold glow">
            ΧΟΡΟΕΣΠΕΡΙΔΑ ΘΑΡΡΟΥΝΙΑ
            <span id="year" class="badge bg-success rounded-pill"></span>
          </h1>
          <br />
          <p class="fs-12 text-center text-body-secondary">
            <strong>
              Η κλήρωση λαχνών διεξάγεται με μια υπερσύγχρονη ηλεκτρονική μορφή,
              η οποία όχι μόνο εξασφαλίζει απόλυτη διαφάνεια, αλλά και
              διασφαλίζει την ακεραιότητα της διαδικασίας σε κάθε στάδιο. Αυτή η
              μέθοδος εγγυάται ένα δίκαιο και αμερόληπτο αποτέλεσμα,
              διασφαλίζοντας ότι κάθε συμμετέχων έχει ίσες πιθανότητες και ότι
              το τελικό αποτέλεσμα είναι αδιάβλητο και αξιόπιστο.
            </strong>
          </p>
        </div>
      </div>
      <hr />
      <div class="row align-items-center g-lg-5 py-5">
        <div class="col-md-10 mx-auto col-lg-8">
          <form class="p-4 p-md-5 border rounded-3 bg-body-tertiary">
            <div class="form-floating mb-3">
              <input
                type="text"
                class="form-control"
                id="ncount"
                placeholder="Total number of tickets"
                value="1..5000"
              />
              <label for="ncount"
                >Αριθμοί λαχνών που συμμετέχουν στην κλήρωση</label
              >
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="d-grid gap-2 col-12">
                  <button
                    type="button"
                    class="btn btn-lg btn-primary"
                    onclick="shuffle();"
                  >
                    <strong>🔀 Ανακάτεψε</strong>
                  </button>
                </div>
              </div>
              <div class="col-md-6">
                <div class="d-grid gap-2 col-12">
                  <button
                    type="button"
                    class="btn btn-lg btn-danger"
                    onclick="remove();"
                  >
                    <strong>❌ Διαγραφή</strong>
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <hr />
      <div class="row align-items-center g-lg-5 py-5">
        <div class="col-lg-12 text-center text-lg-start">
          <table class="table table-dark table-striped">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Δώρο</th>
                <th scope="col">Χορηγός</th>
                <th scope="col">Λαχνός #</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="row">
        <p id="sign" class="text-body-secondary"></p>
      </div>
    </div>
  </body>
</html>
